dependencies:
	sudo apt install python3 python3-dev python3-virtualenv postgresql nodejs npm

node:
	cd project/{{ projectname }}/layout; npm install

migrations:
	docker-compose exec django ../bin/python manage.py makemigrations --noinput

migrate:
	docker-compose exec django ../bin/python manage.py migrate --noinput

locals:
	docker-compose exec django ../bin/python manage.py createlocals

messages: locals
	docker-compose exec django ../bin/python manage.py makemessages -a
	docker-compose exec django ../bin/python manage.py compilemessages
	docker-compose restart django

{% if  development %}
theme: node
	cd project/{{ projectname }}/layout; npm run dev
	docker-compose exec django ../bin/python manage.py collectstatic --noinput -l
	cd project/{{ projectname }}/layout; npm run watch
{% else %}
theme: node
	cd project/{{ projectname }}/layout; npm run build
	docker-compose exec django ../bin/python manage.py collectstatic --noinput
{% endif %}

pull:
	cd project/{{ projectname }}; git pull

update: pull migrate messages theme

