dependencies:
	sudo apt install python3 python3-dev python3-virtualenv postgresql nodejs npm

node:
	cd project/{{ projectname }}/layout; npm install

up:
	docker-compose up -d --scale wsgi={{ scale }}
	{% if not development %}
	chown www-data:www-data static -R
	chown www-data:www-data media -R
	{% endif %}

down:
	docker-compose down

restart: down up

migrations:
	docker-compose exec wsgi ../bin/python manage.py makemigrations

migrate:
	docker-compose exec wsgi ../bin/python manage.py migrate

messages:
	{% if  development %}
	docker-compose exec wsgi ../bin/python manage.py  makeallmessages -a -i node_modules
	{% endif %}
	docker-compose exec wsgi ../bin/python manage.py compilemessages

clearmessages:
	cd project/{{ projectname }}; git checkout */locale/*/LC_MESSAGES/*.po

{% if  development %}
theme: node
	cd project/{{ projectname }}/layout; npm run dev
	docker-compose exec wsgi ../bin/python manage.py collectstatic --noinput -l
	cd project/{{ projectname }}/layout; npm run watch

fixtures:
	docker-compose exec wsgi ../bin/python manage.py loaddata initial_users initial_exhibitors initial_downloadarea initial_showcase initial_links initial_videos initial_events

{% else %}
theme: node
	cd project/{{ projectname }}/layout; npm run build
	docker-compose exec wsgi ../bin/python manage.py collectstatic --noinput

fixtures:
	echo "Skipping fixtures in production"
{% endif %}

pull:
	cd project/{{ projectname }}; git pull

update: pull migrate fixtures messages theme restart

logs:
	docker-compose logs -f --timestamp --tail 100
