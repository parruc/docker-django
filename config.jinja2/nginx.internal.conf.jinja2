server {
    listen 80;
    server_name default_server;
    error_log  /var/log/nginx/error.log;
    access_log /var/log/nginx/access.log;
    client_max_body_size {{ uploadlimit }}m;
    root /var/www;
    
{% if react %}
    location ~ ^/api/(static|media)/ {
{% else %}
    location ~ ^/(static|media)/ {
{% endif %}
        location ~ \.mp4$$ {
            mp4;
            expires 15d;
        }
        location ~ \.(m4s|ts|jpg|jpeg|png|gif|ico|css|js)$$ {
            expires 15d;
        }
    }

    # Finally, send all non-media requests to the Django server.
{% if react %}
    location /api {
{% else %}
    location / {
{% endif %}
        uwsgi_pass django:8000;
        include uwsgi_params;
        {% if certificatespath %}
#            uwsgi_param HTTPS $env_https;
        {% endif %}
    }

{% if react %}
    location / {
    {% if development %}
       proxy_pass http://react:3000;
    {% else %}
       try_files $uri /index.html =404;
       index index.html index.htm;
    {% endif %}
    }
{% endif %}
}
